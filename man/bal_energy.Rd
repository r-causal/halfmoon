% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_balance.R
\name{bal_energy}
\alias{bal_energy}
\title{Balance Energy Distance}
\usage{
bal_energy(
  covariates,
  group,
  weights = NULL,
  estimand = "ATE",
  focal_group = NULL,
  improved = TRUE,
  standardized = TRUE,
  na.rm = FALSE
)
}
\arguments{
\item{covariates}{A data frame or matrix containing the covariates to compare.
All variables must be numeric. For categorical variables, use dummy coding.}

\item{group}{A vector (factor or numeric) indicating group membership. For
binary and multi-category treatments, must have 2+ unique levels. For
continuous treatments, should be numeric.}

\item{weights}{An optional numeric vector of case weights. If provided, must
have the same length as rows in \code{covariates}. All weights must be non-negative.}

\item{estimand}{Character string specifying the estimand. Options are:
\itemize{
\item "ATE" (Average Treatment Effect, default): Balance across all groups
\item "ATT" (Average Treatment Effect on Treated): Balance for treated group
\item "ATC" (Average Treatment Effect on Controls): Balance for control group
\item NULL: Between-group energy distance only
For continuous treatments, only NULL is supported.
}}

\item{focal_group}{The focal group level for ATT/ATC. If \code{NULL} (default),
automatically determined based on estimand.}

\item{improved}{Logical. Use improved energy distance for ATE? Default is TRUE.
When TRUE, adds pairwise treatment comparisons for better group separation.}

\item{standardized}{Logical. For continuous treatments, return standardized
distance correlation? Default is TRUE.}

\item{na.rm}{A logical value indicating whether to remove missing values
before computation. If \code{FALSE} (default), missing values result in
an error (energy distance cannot be computed with missing data).}
}
\value{
A numeric value representing the energy distance. Lower values
indicate better balance, with 0 indicating perfect balance. For continuous
treatments, returns distance correlation (0 = independence).
}
\description{
Computes the energy distance as a multivariate measure of covariate balance
between groups. Energy distance captures the similarity between distributions
across the entire joint distribution of covariates, making it more comprehensive
than univariate balance measures.
}
\details{
Energy distance is based on the energy statistics framework (Székely & Rizzo, 2004)
and implemented following Huling & Mak (2024). The calculation uses a quadratic
form: w^T P w + q^T w + k, where the components depend on the estimand.

For binary variables in the covariates, variance is calculated as p(1-p)
rather than sample variance to prevent over-weighting.

For continuous treatments, the function uses distance correlation instead of
traditional energy distance, measuring independence between treatment and covariates.
}
\examples{
# Binary treatment
bal_energy(
  covariates = dplyr::select(nhefs_weights, age, wt71, smokeyrs),
  group = nhefs_weights$qsmk
)

# With weights
bal_energy(
  covariates = dplyr::select(nhefs_weights, age, wt71, smokeyrs),
  group = nhefs_weights$qsmk,
  weights = nhefs_weights$w_ate
)

# ATT estimand
bal_energy(
  covariates = dplyr::select(nhefs_weights, age, wt71, smokeyrs),
  group = nhefs_weights$qsmk,
  weights = nhefs_weights$w_att,
  estimand = "ATT"
)

}
\references{
Huling, J. D., & Mak, S. (2024). Energy Balancing of Covariate Distributions.
Journal of Causal Inference, 12(1).

Székely, G. J., & Rizzo, M. L. (2004). Testing for equal distributions in
high dimension. InterStat, 5.
}
