% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/geom_calibration.R
\name{check_calibration}
\alias{check_calibration}
\title{Compute calibration data for binary outcomes}
\usage{
check_calibration(
  data,
  .fitted,
  .group,
  treatment_level = NULL,
  method = c("breaks", "logistic", "windowed"),
  bins = 10,
  binning_method = c("equal_width", "quantile"),
  smooth = TRUE,
  conf_level = 0.95,
  window_size = 0.1,
  step_size = window_size/2,
  k = 10,
  na.rm = FALSE
)
}
\arguments{
\item{data}{A data frame containing the data.}

\item{.fitted}{Column name of predicted probabilities (numeric between 0 and 1).
Can be unquoted (e.g., \code{p}) or quoted (e.g., \code{"p"}).}

\item{.group}{Column name of treatment/group variable.
Can be unquoted (e.g., \code{g}) or quoted (e.g., \code{"g"}).}

\item{treatment_level}{The level of the outcome variable to consider as the
treatment/event. If \code{NULL} (default), uses the last level for factors or
the maximum value for numeric variables.}

\item{method}{Character; calibration method. One of: "breaks", "logistic", or "windowed".}

\item{bins}{Integer > 1; number of bins for the "breaks" method.}

\item{binning_method}{"equal_width" or "quantile" for bin creation (breaks method only).}

\item{smooth}{Logical; for "logistic" method, use GAM smoothing via the mgcv package.}

\item{conf_level}{Numeric in (0,1); confidence level for CIs (default = 0.95).}

\item{window_size}{Numeric; size of each window for "windowed" method.}

\item{step_size}{Numeric; distance between window centers for "windowed" method.}

\item{k}{Integer; the basis dimension for GAM smoothing when method = "logistic" and smooth = \code{TRUE.} Default is 10.}

\item{na.rm}{Logical; if \code{TRUE}, drop \code{NA} values before summarizing.}
}
\value{
A tibble with columns:
\itemize{
\item For "breaks" method:
\itemize{
\item \code{.bin}: integer bin index
\item \code{predicted_rate}: mean predicted probability in bin
\item \code{observed_rate}: observed treatment rate in bin
\item \code{count}: number of observations in bin
\item \code{lower}: lower bound of CI for \code{observed_rate}
\item \code{upper}: upper bound of CI for \code{observed_rate}
}
\item For "logistic" and "windowed" methods:
\itemize{
\item \code{predicted_rate}: predicted probability values
\item \code{observed_rate}: calibrated outcome rate
\item \code{lower}: lower bound of CI
\item \code{upper}: upper bound of CI
}
}
}
\description{
\code{check_calibration()} summarizes predicted probabilities and observed outcomes,
computing mean prediction, observed rate, counts, and confidence intervals.
Calibration represents the agreement between predicted probabilities and observed outcomes.
Supports multiple methods for calibration assessment.
}
\examples{
# Using the included `nhefs_weights` dataset
# `.fitted` contains propensity scores, and `qsmk` is the treatment variable
check_calibration(nhefs_weights, .fitted, qsmk)

# Logistic method with smoothing
check_calibration(nhefs_weights, .fitted, qsmk, method = "logistic")

# Windowed method
check_calibration(nhefs_weights, .fitted, qsmk, method = "windowed")

}
