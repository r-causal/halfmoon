% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/geom_calibration.R
\name{geom_calibration}
\alias{geom_calibration}
\title{Geom for calibration plot with confidence intervals}
\usage{
geom_calibration(
  mapping = NULL,
  data = NULL,
  method = "breaks",
  bins = 10,
  binning_method = "equal_width",
  smooth = TRUE,
  conf_level = 0.95,
  window_size = 0.1,
  step_size = window_size/2,
  treatment_level = NULL,
  k = 10,
  show_ribbon = TRUE,
  show_points = TRUE,
  position = "identity",
  na.rm = FALSE,
  show.legend = NA,
  inherit.aes = TRUE,
  ...
)
}
\arguments{
\item{mapping}{Aesthetic mapping (must supply \code{estimate} and \code{truth} if not inherited).
\code{estimate} should be propensity scores/predicted probabilities, \code{truth} should be treatment variable.}

\item{data}{Data frame or tibble; if NULL, uses ggplot default.}

\item{method}{Character; calibration method - "breaks", "logistic", or "windowed".}

\item{bins}{Integer >1; number of bins for the "breaks" method.}

\item{binning_method}{"equal_width" or "quantile" for bin creation (breaks method only).}

\item{smooth}{Logical; for "logistic" method, use GAM smoothing if available.}

\item{conf_level}{Numeric in (0,1); confidence level for CIs (default = 0.95).}

\item{window_size}{Numeric; size of each window for "windowed" method.}

\item{step_size}{Numeric; distance between window centers for "windowed" method.}

\item{treatment_level}{The level of the outcome variable to consider as the
treatment/event. If \code{NULL} (default), uses the last level for factors or
the maximum value for numeric variables.}

\item{k}{Integer; the basis dimension for GAM smoothing when method = "logistic" and smooth = TRUE. Default is 10.}

\item{show_ribbon}{Logical; show confidence interval ribbon.}

\item{show_points}{Logical; show points (only for "breaks" and "windowed" methods).}

\item{position}{Position adjustment.}

\item{na.rm}{If \code{FALSE}, the default, missing values are removed with a warning.
If \code{TRUE}, missing values are silently removed.}

\item{show.legend}{Logical. Should this layer be included in the legends?
\code{NA}, the default, includes if any aesthetics are mapped.}

\item{inherit.aes}{If \code{FALSE}, overrides the default aesthetics, rather than
combining with them.}

\item{...}{Other arguments passed on to layer().}
}
\value{
A ggplot2 layer or list of layers
}
\description{
\code{geom_calibration()} creates calibration plots to assess the agreement between predicted
probabilities and observed binary outcomes. It supports three methods:
binning ("breaks"), logistic regression ("logistic"), and windowed ("windowed"), all computed with \code{\link[=check_calibration]{check_calibration()}}.
}
\details{
This geom provides a ggplot2 layer for creating calibration plots with confidence
intervals. The geom automatically computes calibration statistics using the
specified method and renders appropriate geometric elements (points, lines, ribbons)
to visualize the relationship between predicted and observed rates.

The three methods offer different approaches to calibration assessment:
\itemize{
\item \strong{"breaks"}: Discrete binning approach, useful for understanding calibration
across prediction ranges with sufficient sample sizes
\item \strong{"logistic"}: Regression-based approach that can include smoothing for
continuous calibration curves
\item \strong{"windowed"}: Sliding window approach providing smooth curves without
requiring additional packages
}
}
\examples{
library(ggplot2)

# Basic calibration plot using nhefs_weights dataset
# .fitted contains propensity scores, qsmk is the treatment variable
ggplot(nhefs_weights, aes(estimate = .fitted, truth = qsmk)) +
  geom_calibration() +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(x = "Propensity Score", y = "Observed Treatment Rate")

# Using different methods
ggplot(nhefs_weights, aes(estimate = .fitted, truth = qsmk)) +
  geom_calibration(method = "logistic") +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(x = "Propensity Score", y = "Observed Treatment Rate")

# Specify treatment level explicitly
ggplot(nhefs_weights, aes(estimate = .fitted, truth = qsmk)) +
  geom_calibration(treatment_level = "1") +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(x = "Propensity Score", y = "Observed Treatment Rate")

# Windowed method with custom parameters
ggplot(nhefs_weights, aes(estimate = .fitted, truth = qsmk)) +
  geom_calibration(method = "windowed", window_size = 0.2, step_size = 0.1) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(x = "Propensity Score", y = "Observed Treatment Rate")
}
\seealso{
\code{\link[=check_calibration]{check_calibration()}} for computing calibration statistics

Other ggplot2 functions: 
\code{\link{geom_ecdf}()},
\code{\link{geom_mirror_histogram}()},
\code{\link{geom_qq2}()},
\code{\link{geom_roc}()}
}
\concept{ggplot2 functions}
