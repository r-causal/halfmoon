<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute Prognostic Scores for Balance Assessment — bal_prognostic_score • halfmoon</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute Prognostic Scores for Balance Assessment — bal_prognostic_score"><meta name="description" content="Calculates prognostic scores by fitting an outcome model on the control group
and generating predictions for all observations. Prognostic scores represent
the expected outcome under control conditions and are useful for assessing
whether balance on treatment predictors ensures balance on outcome-relevant
variables."><meta property="og:description" content="Calculates prognostic scores by fitting an outcome model on the control group
and generating predictions for all observations. Prognostic scores represent
the expected outcome under control conditions and are useful for assessing
whether balance on treatment predictors ensures balance on outcome-relevant
variables."><meta property="og:image" content="https://r-causal.github.io/halfmoon/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">halfmoon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-causal/halfmoon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute Prognostic Scores for Balance Assessment</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-causal/halfmoon/blob/main/R/bal_prognostic_score.R" class="external-link"><code>R/bal_prognostic_score.R</code></a></small>
      <div class="d-none name"><code>bal_prognostic_score.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates prognostic scores by fitting an outcome model on the control group
and generating predictions for all observations. Prognostic scores represent
the expected outcome under control conditions and are useful for assessing
whether balance on treatment predictors ensures balance on outcome-relevant
variables.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bal_prognostic_score</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">treatment</span>,</span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>A data frame containing the variables for analysis</p></dd>


<dt id="arg-outcome">outcome<a class="anchor" aria-label="anchor" href="#arg-outcome"></a></dt>
<dd><p>The outcome variable. Can be specified as a bare name or
character string. Ignored if <code>formula</code> is provided.</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>Variables to include in the outcome model. Defaults to
<code><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything()</a></code> which includes all variables except the outcome and treatment.
Supports tidyselect syntax. Ignored if <code>formula</code> is provided.</p></dd>


<dt id="arg-treatment">treatment<a class="anchor" aria-label="anchor" href="#arg-treatment"></a></dt>
<dd><p>The treatment variable. Can be specified as a bare name or
character string.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Optional formula for the outcome model. If provided, <code>outcome</code>
and <code>covariates</code> arguments are ignored. The formula should not include the
treatment variable.</p></dd>


<dt id="arg-treatment-level">treatment_level<a class="anchor" aria-label="anchor" href="#arg-treatment-level"></a></dt>
<dd><p>The level of treatment that represents the control group.
If NULL (default), the first level is used as control.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>A family object for the GLM. Defaults to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code> for
continuous outcomes. Use <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> for binary outcomes.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Optional weights for the outcome model. Can be a numeric vector
or bare name of a variable in <code>.data</code>.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical. Should missing values be removed? Defaults to FALSE.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric vector of prognostic scores with the same length as the
number of rows in <code>.data</code> (after NA removal if <code>na.rm = TRUE</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The prognostic score method, introduced by Stuart et al. (2013), provides a
way to assess balance that focuses on variables predictive of the outcome
rather than just the treatment assignment. The procedure:</p><ol><li><p>Fits an outcome model using only control group observations</p></li>
<li><p>Generates predictions (prognostic scores) for all observations</p></li>
<li><p>Returns these scores for balance assessment</p></li>
</ol><p>This approach is particularly useful when:</p><ul><li><p>The outcome model includes non-linearities or interactions</p></li>
<li><p>You want to ensure balance on outcome-relevant variables</p></li>
<li><p>Traditional propensity score balance checks may miss important imbalances</p></li>
</ul><p>The returned prognostic scores can be used with existing balance functions
like <code><a href="bal_smd.html">bal_smd()</a></code>, <code><a href="bal_vr.html">bal_vr()</a></code>, or <code><a href="check_balance.html">check_balance()</a></code> to assess balance between
treatment groups.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Stuart EA, Lee BK, Leacy FP. Prognostic score-based balance measures can be
a useful diagnostic for propensity score methods in comparative effectiveness
research. J Clin Epidemiol. 2013;66(8):S84-S90.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Using tidyselect interface</span></span></span>
<span class="r-in"><span><span class="va">prog_scores</span> <span class="op">&lt;-</span> <span class="fu">bal_prognostic_score</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">nhefs_weights</span>,</span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">wt82_71</span>,</span></span>
<span class="r-in"><span>  treatment <span class="op">=</span> <span class="va">qsmk</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex</span>, <span class="va">race</span>, <span class="va">wt71</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using formula interface</span></span></span>
<span class="r-in"><span><span class="va">prog_scores_formula</span> <span class="op">&lt;-</span> <span class="fu">bal_prognostic_score</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">nhefs_weights</span>,</span></span>
<span class="r-in"><span>  treatment <span class="op">=</span> <span class="va">qsmk</span>,</span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">wt82_71</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add to data and check balance</span></span></span>
<span class="r-in"><span><span class="va">nhefs_with_prog</span> <span class="op">&lt;-</span> <span class="va">nhefs_weights</span></span></span>
<span class="r-in"><span><span class="va">nhefs_with_prog</span><span class="op">$</span><span class="va">prog_score</span> <span class="op">&lt;-</span> <span class="va">prog_scores</span></span></span>
<span class="r-in"><span><span class="fu"><a href="check_balance.html">check_balance</a></span><span class="op">(</span><span class="va">nhefs_with_prog</span>, <span class="va">prog_score</span>, <span class="va">qsmk</span>, .wts <span class="op">=</span> <span class="va">w_ate</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 8 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   variable   group_level method   metric  estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> prog_score 0           observed ks      0.124   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> prog_score 0           w_ate    ks      0.031<span style="text-decoration: underline;">6</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> prog_score 0           observed smd    -<span style="color: #BB0000;">0.267</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> prog_score 0           w_ate    smd     0.003<span style="text-decoration: underline;">05</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> prog_score 0           observed vr      1.06    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> prog_score 0           w_ate    vr      1.01    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">7</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>          observed energy  0.044<span style="text-decoration: underline;">2</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">8</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>          w_ate    energy  0.000<span style="text-decoration: underline;">954</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For binary outcome</span></span></span>
<span class="r-in"><span><span class="va">prog_scores_binary</span> <span class="op">&lt;-</span> <span class="fu">bal_prognostic_score</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">nhefs_weights</span>,</span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">death</span>,</span></span>
<span class="r-in"><span>  treatment <span class="op">=</span> <span class="va">qsmk</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>prediction from rank-deficient fit; attr(*, "non-estim") has doubtful cases</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

