<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute calibration data for binary outcomes — check_calibration • halfmoon</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute calibration data for binary outcomes — check_calibration"><meta name="description" content="check_calibration() summarizes predicted probabilities and observed outcomes,
computing mean prediction, observed rate, counts, and confidence intervals.
Calibration represents the agreement between predicted probabilities and observed outcomes.
Supports multiple methods for calibration assessment."><meta property="og:description" content="check_calibration() summarizes predicted probabilities and observed outcomes,
computing mean prediction, observed rate, counts, and confidence intervals.
Calibration represents the agreement between predicted probabilities and observed outcomes.
Supports multiple methods for calibration assessment."><meta property="og:image" content="https://r-causal.github.io/halfmoon/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">halfmoon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-causal/halfmoon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute calibration data for binary outcomes</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-causal/halfmoon/blob/main/R/geom_calibration.R" class="external-link"><code>R/geom_calibration.R</code></a></small>
      <div class="d-none name"><code>check_calibration.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>check_calibration()</code> summarizes predicted probabilities and observed outcomes,
computing mean prediction, observed rate, counts, and confidence intervals.
Calibration represents the agreement between predicted probabilities and observed outcomes.
Supports multiple methods for calibration assessment.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">check_calibration</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">.fitted</span>,</span>
<span>  <span class="va">.group</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"breaks"</span>, <span class="st">"logistic"</span>, <span class="st">"windowed"</span><span class="op">)</span>,</span>
<span>  bins <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  binning_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"equal_width"</span>, <span class="st">"quantile"</span><span class="op">)</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  step_size <span class="op">=</span> <span class="va">window_size</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame containing the data.</p></dd>


<dt id="arg--fitted">.fitted<a class="anchor" aria-label="anchor" href="#arg--fitted"></a></dt>
<dd><p>Column name of predicted probabilities (numeric between 0 and 1).
Can be unquoted (e.g., <code>p</code>) or quoted (e.g., <code>"p"</code>).</p></dd>


<dt id="arg--group">.group<a class="anchor" aria-label="anchor" href="#arg--group"></a></dt>
<dd><p>Column name of treatment/group variable.
Can be unquoted (e.g., <code>g</code>) or quoted (e.g., <code>"g"</code>).</p></dd>


<dt id="arg-treatment-level">treatment_level<a class="anchor" aria-label="anchor" href="#arg-treatment-level"></a></dt>
<dd><p>The level of the outcome variable to consider as the
treatment/event. If <code>NULL</code> (default), uses the last level for factors or
the maximum value for numeric variables.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character; calibration method. One of: "breaks", "logistic", or "windowed".</p></dd>


<dt id="arg-bins">bins<a class="anchor" aria-label="anchor" href="#arg-bins"></a></dt>
<dd><p>Integer &gt; 1; number of bins for the "breaks" method.</p></dd>


<dt id="arg-binning-method">binning_method<a class="anchor" aria-label="anchor" href="#arg-binning-method"></a></dt>
<dd><p>"equal_width" or "quantile" for bin creation (breaks method only).</p></dd>


<dt id="arg-smooth">smooth<a class="anchor" aria-label="anchor" href="#arg-smooth"></a></dt>
<dd><p>Logical; for "logistic" method, use GAM smoothing via the mgcv package.</p></dd>


<dt id="arg-conf-level">conf_level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>Numeric in (0,1); confidence level for CIs (default = 0.95).</p></dd>


<dt id="arg-window-size">window_size<a class="anchor" aria-label="anchor" href="#arg-window-size"></a></dt>
<dd><p>Numeric; size of each window for "windowed" method.</p></dd>


<dt id="arg-step-size">step_size<a class="anchor" aria-label="anchor" href="#arg-step-size"></a></dt>
<dd><p>Numeric; distance between window centers for "windowed" method.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Integer; the basis dimension for GAM smoothing when method = "logistic" and smooth = <code>TRUE.</code> Default is 10.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, drop <code>NA</code> values before summarizing.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble with columns:</p><ul><li><p>For "breaks" method:</p><ul><li><p><code>.bin</code>: integer bin index</p></li>
<li><p><code>predicted_rate</code>: mean predicted probability in bin</p></li>
<li><p><code>observed_rate</code>: observed treatment rate in bin</p></li>
<li><p><code>count</code>: number of observations in bin</p></li>
<li><p><code>lower</code>: lower bound of CI for <code>observed_rate</code></p></li>
<li><p><code>upper</code>: upper bound of CI for <code>observed_rate</code></p></li>
</ul></li>
<li><p>For "logistic" and "windowed" methods:</p><ul><li><p><code>predicted_rate</code>: predicted probability values</p></li>
<li><p><code>observed_rate</code>: calibrated outcome rate</p></li>
<li><p><code>lower</code>: lower bound of CI</p></li>
<li><p><code>upper</code>: upper bound of CI</p></li>
</ul></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Using the included `nhefs_weights` dataset</span></span></span>
<span class="r-in"><span><span class="co"># `.fitted` contains propensity scores, and `qsmk` is the treatment variable</span></span></span>
<span class="r-in"><span><span class="fu">check_calibration</span><span class="op">(</span><span class="va">nhefs_weights</span>, <span class="va">.fitted</span>, <span class="va">qsmk</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Small sample sizes or extreme proportions detected in bins 9, 10 (n = 8, 3).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Confidence intervals may be unreliable. Consider using fewer bins or a</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> different calibration method.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 10 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     .bin predicted_rate observed_rate count  lower upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1         0.097<span style="text-decoration: underline;">1</span>        0.064<span style="text-decoration: underline;">9</span>   154 0.033<span style="text-decoration: underline;">3</span> 0.119</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2         0.162         0.166    355 0.130  0.210</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3         0.230         0.254    445 0.215  0.298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4         0.302         0.294    293 0.243  0.350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5         0.372         0.368    155 0.293  0.449</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6         0.443         0.372     86 0.272  0.484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7         0.516         0.511     45 0.360  0.661</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8         0.591         0.773     22 0.542  0.913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9         0.648         0.375      8 0.102  0.741</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10         0.738         1          3 1      1    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Logistic method with smoothing</span></span></span>
<span class="r-in"><span><span class="fu">check_calibration</span><span class="op">(</span><span class="va">nhefs_weights</span>, <span class="va">.fitted</span>, <span class="va">qsmk</span>, method <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 100 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    predicted_rate observed_rate     lower     upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl[1d]&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>         0.051<span style="text-decoration: underline;">0</span>        0.065<span style="text-decoration: underline;">1</span>    0.036<span style="text-decoration: underline;">3</span>     0.114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>         0.058<span style="text-decoration: underline;">3</span>        0.069<span style="text-decoration: underline;">4</span>    0.040<span style="text-decoration: underline;">4</span>     0.117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>         0.065<span style="text-decoration: underline;">7</span>        0.074<span style="text-decoration: underline;">0</span>    0.044<span style="text-decoration: underline;">8</span>     0.120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>         0.073<span style="text-decoration: underline;">0</span>        0.078<span style="text-decoration: underline;">9</span>    0.049<span style="text-decoration: underline;">7</span>     0.123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>         0.080<span style="text-decoration: underline;">3</span>        0.084<span style="text-decoration: underline;">0</span>    0.054<span style="text-decoration: underline;">9</span>     0.126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>         0.087<span style="text-decoration: underline;">7</span>        0.089<span style="text-decoration: underline;">4</span>    0.060<span style="text-decoration: underline;">6</span>     0.130</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>         0.095<span style="text-decoration: underline;">0</span>        0.095<span style="text-decoration: underline;">2</span>    0.066<span style="text-decoration: underline;">6</span>     0.134</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>         0.102         0.101     0.073<span style="text-decoration: underline;">0</span>     0.139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>         0.110         0.108     0.079<span style="text-decoration: underline;">7</span>     0.144</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>         0.117         0.114     0.086<span style="text-decoration: underline;">8</span>     0.149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 90 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Windowed method</span></span></span>
<span class="r-in"><span><span class="fu">check_calibration</span><span class="op">(</span><span class="va">nhefs_weights</span>, <span class="va">.fitted</span>, <span class="va">qsmk</span>, method <span class="op">=</span> <span class="st">"windowed"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Small sample sizes or extreme proportions detected in windows centered at 0.7,</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> 0.75, 0.8 (n = 5, 3, 1). Confidence intervals may be unreliable. Consider using</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> a larger window size or a different calibration method.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 16 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    predicted_rate observed_rate  lower upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>           0.05        0.050<span style="text-decoration: underline;">6</span> 0.016<span style="text-decoration: underline;">3</span> 0.131</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>           0.1         0.106  0.073<span style="text-decoration: underline;">1</span> 0.152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>           0.15        0.156  0.124  0.193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>           0.2         0.212  0.180  0.248</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>           0.25        0.258  0.223  0.296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>           0.3         0.290  0.248  0.337</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>           0.35        0.327  0.274  0.386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>           0.4         0.370  0.301  0.444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>           0.45        0.420  0.331  0.514</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>           0.5         0.467  0.352  0.585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>           0.55        0.562  0.413  0.702</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span>           0.6         0.724  0.525  0.866</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span>           0.65        0.625  0.359  0.837</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span>           0.7         0.6    0.170  0.927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">15</span>           0.75        1      1      1    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">16</span>           0.8         1      1      1    </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

